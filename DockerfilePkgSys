FROM ros2_humble_canopen_build:v0 

EXPOSE 8000 9090 11811

ENV WS_NAME=packaging_system
RUN mkdir -p /${WS_NAME}/src

WORKDIR /${WS_NAME}

COPY ./src/packaging_machine_comm ./src/packaging_machine_comm
COPY ./src/packaging_machine_control_system ./src/packaging_machine_control_system

COPY ./src/smdps_msgs ./src/smdps_msgs

COPY ./src/ros2_canopen ./src/ros2_canopen

RUN . /opt/ros/${ROS_DISTRO}/setup.sh && colcon build --cmake-args -DCMAKE_BUILD_TYPE=Release --symlink-install

RUN mkdir -p /logs
ENV ROS_LOG_DIR=/logs
VOLUME [ "/logs", "/dev/bus", "/dev/serial" ]

COPY --chmod=755 ./docker/entrypoint.sh /
RUN dos2unix /entrypoint.sh 
ENTRYPOINT [ "/entrypoint.sh" ]